function REST_item(a, b, c, d) {
    this.data = b, this["delete"] = function(b) {
        c["delete"](a, b);
    }, this.update = function(b, d) {
        c.update(a, b, d);
    }, this.REST_variable = function(b, c, e) {
        return new REST_variable(d + "/" + a + "/" + b, REST_helpers.option(c, {
            name: this.options.name + "/" + d
        }), e);
    }, this.REST_list = function(b, c, e) {
        return new REST_list(d + "/" + a + "/" + b, REST_helpers.option(c, {
            name: this.options.name + "/" + d
        }), e);
    };
}

function REST_list(a, b, c) {
    this.data = !1, this.id = !1, this.url = a;
    var d = !1, e = this;
    b = "undefined" != typeof b ? b : {}, this.options = REST_helpers.option(b, {
        readOnCreated: REST.defaults.readOnCreated,
        successGetHeader: REST.defaults.successGetHeader,
        successPostHeader: REST.defaults.successPostHeader,
        successDeleteHeader: REST.defaults.successDeleteHeader,
        successPutHeader: REST.defaults.successPutHeader,
        converter: REST.defaults.list_converter,
        reGenarateIds: function() {
            e.id = [];
            for (var a = 0; a < e.data.length; a++) "undefined" != typeof e.data[a] && (e.id[e.data[a].id] = a);
        },
        name: a,
        get: function(b) {
            REST_ajax.get(a, function(a) {
                var c = e.options.converter(a);
                c === !1 ? e.options.dataError() : (e.data = c.items, e.id = c.id, d ? REST_notifyer.emitUpdate(e.options.name, e.data) : (d = !0, 
                "function" == typeof b && b(e.data), REST_notifyer.emitLoaded(e.options.name, e.data)));
            }, e.options.successGetHeader, function(a) {
                e.options.getError(a);
            });
        },
        "delete": function(b, c) {
            REST_ajax["delete"](a + "/" + b, function() {
                "undefined" != typeof e.id[b] && (delete e.data[e.id[b]], delete e.id[b], e.options.reGenarateIds(), 
                "function" == typeof c && c(b), REST_notifyer.emitDelete(e.options.name, b));
            }, e.options.successDeleteHeader, function(a) {
                e.options.deleteError(a);
            });
        },
        add: function(b, c) {
            REST_ajax.post(a, function(a) {
                /^[0-9]+$/.test(a) ? "undefined" == typeof e.data[a] ? (b.id = a, e.data.push(b), 
                e.id[a] = e.data.push(b), "function" == typeof c && c(b), REST_notifyer.emitAdd(e.options.name, b)) : e.options.addError("id allready exist") : e.options.addError("id isnt a int");
            }, b, e.options.successPostHeader, function(a) {
                e.options.addError(a);
            });
        },
        update: function(b, c, d) {
            REST_ajax.put(a + "/" + b, function() {
                for (var a in c) e.data[e.id[b]][a] = c[a];
                "function" == typeof d && d(c), REST_notifyer.emitUpdate(e.options.name, b, c);
            }, c, e.options.successPutHeader, function(a) {
                e.options.updateError(a);
            });
        },
        getError: function(a) {
            console.error("REST GET ERROR"), console.error(a);
        },
        addError: function(a) {
            console.error("REST ADD ERROR"), console.error(a);
        },
        deleteError: function(a) {
            console.error("REST DELETE ERROR"), console.error(a);
        },
        updateError: function(a) {
            console.error("REST UPDATE ERROR"), console.error(a);
        },
        dataError: function() {
            console.error("REST FORMATTED DATA ERROR");
        }
    }), this.get = function(a) {
        this.options.get(a);
    }, this["delete"] = function(a, b) {
        this.options["delete"](a, b);
    }, this.update = function(a, b, c) {
        this.options.update(a, b, c);
    }, this.add = function(a, b) {
        this.options.add(a, b);
    }, this.find = function(b) {
        return "undefined" == typeof this.data[b] ? !1 : new REST_item(b, this.data[b], this.options, a);
    }, this.REST_variable = function(b, c, d) {
        return new REST_variable(this.url + "/" + b, REST_helpers.option(c, {
            name: this.options.name + "/" + a
        }), d);
    }, this.REST_list = function(b, c, d) {
        return new REST_list(this.url + "/" + b, REST_helpers.option(c, {
            name: this.options.name + "/" + a
        }), d);
    }, this.options.readOnCreated && this.options.get(c);
}

function REST_variable(a, b, c) {
    this.data = !1, this.url = a;
    var d = !1, e = this;
    b = "undefined" != typeof b ? b : {}, this.options = REST_helpers.option(b, {
        readOnCreated: REST.defaults.readOnCreated,
        successGetHeader: REST.defaults.successGetHeader,
        successPostHeader: REST.defaults.successPostHeader,
        successDeleteHeader: REST.defaults.successDeleteHeader,
        successPutHeader: REST.defaults.successPutHeader,
        converter: REST.defaults.variable_converter,
        name: a,
        get: function(b) {
            REST_ajax.get(a, function(a) {
                e.data = e.options.converter(a), d ? REST_notifyer.emitUpdate(e.options.name, e.data) : (d = !0, 
                "function" == typeof b && b(e.data), REST_notifyer.emitLoaded(e.options.name, e.data));
            }, e.options.successGetHeader, function(a) {
                e.options.getError(a);
            });
        },
        "delete": function() {
            console.error("Simple variables cant be deleted or added by default");
        },
        add: function() {
            console.error("Simple variables cant be deleted or added by default");
        },
        update: function(b, c) {
            REST_ajax.put(a, function() {
                e.data = b, "function" == typeof c && c(b), REST_notifyer.emitUpdate(e.options.name, b);
            }, {
                data: b
            }, e.options.successPutHeader, function(a) {
                e.options.updateError(a);
            });
        },
        getError: function(a) {
            console.error("REST GET ERROR"), console.error(a);
        },
        addError: function(a) {
            console.error("REST ADD ERROR"), console.error(a);
        },
        deleteError: function(a) {
            console.error("REST DELETE ERROR"), console.error(a);
        },
        updateError: function(a) {
            console.error("REST UPDATE ERROR"), console.error(a);
        }
    }), this.get = function(a) {
        this.options.get(a);
    }, this["delete"] = function() {
        this.options["delete"]();
    }, this.update = function(a, b) {
        this.options.update(a, b);
    }, this.add = function(a) {
        this.options.add(a);
    }, this.onLoaded = function(a) {
        REST_notifyer.onLoaded(b.name, a);
    }, this.onUpdate = function(a) {
        REST_notifyer.onUpdate(b.name, a);
    }, this.onAdd = function(a) {
        REST_notifyer.onAdd(b.name, a);
    }, this.onDelete = function(a) {
        REST_notifyer.onDelete(b.name, a);
    }, this.REST_variable = function(b, c, d) {
        return new REST_variable(this.url + "/" + b, REST_helpers.option(c, {
            name: this.options.name + "/" + a
        }), d);
    }, this.REST_list = function(b, c, d) {
        return new REST_list(this.url + b, REST_helpers.option(c, {
            name: this.options.name + "/" + a
        }), d);
    }, this.options.readOnCreated && this.options.get(c);
}

var REST_ajax = {
    get: function(a, b, c, d) {
        var e = this.helpers.getRequestObject();
        e.onreadystatechange = function() {
            4 == e.readyState && e.status == c ? b(e.response) : 4 == e.readyState && d(e);
        }, e.open("GET", a, !0), e.send();
    },
    post: function(a, b, c, d, e) {
        var f = this.helpers.getRequestObject();
        f.onreadystatechange = function() {
            4 == f.readyState && f.status == d ? b(f.response) : 4 == f.readyState && e(f);
        }, f.open("POST", a, !0), f.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), 
        f.send(this.helpers.toQueryString(c));
    },
    put: function(a, b, c, d, e) {
        var f = this.helpers.getRequestObject();
        f.onreadystatechange = function() {
            4 == f.readyState && f.status == d ? b(f.response) : 4 == f.readyState && e(f);
        }, f.open("POST", a, !0), f.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), 
        c._METHOD = "PUT", f.send(this.helpers.toQueryString(c));
    },
    "delete": function(a, b, c, d) {
        var e = this.helpers.getRequestObject();
        e.onreadystatechange = function() {
            4 == e.readyState && e.status == c ? b(e.response) : 4 == e.readyState && d(e);
        }, e.open("DELETE", a, !0), e.send();
    },
    helpers: {
        getRequestObject: function() {
            var a;
            return a = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
        },
        toQueryString: function(a, b) {
            function c(a, b) {
                var d = [];
                return b = b || [], Object.keys(a).forEach(function(e) {
                    if (a.hasOwnProperty(e)) {
                        var f = b.slice();
                        f.push(e);
                        var g = [];
                        "object" == typeof a[e] ? g = c(a[e], f) : g.push({
                            path: f,
                            val: a[e]
                        }), g.forEach(function(a) {
                            return d.push(a);
                        });
                    }
                }), d;
            }
            var d = c(a);
            d = d.map(function(a) {
                if (1 == a.path.length) a.path = a.path[0]; else {
                    var b = a.path[0], c = a.path.slice(1);
                    a.path = b + "[" + c.join("][") + "]";
                }
                return a;
            });
            var e = d.map(function(a) {
                return a.path + "=" + a.val;
            }).join("&");
            return b ? encodeURIComponent(e) : e;
        }
    }
}, REST_helpers = {
    option: function(a, b) {
        for (var c in a) b[c] = a[c];
        return b;
    }
}, REST_notifyer = {
    funcLoaded: {},
    funcUpdate: {},
    funcAdd: {},
    funcDelete: {},
    onLoaded: function(a, b) {
        this.funcLoaded[a] ? this.funcLoaded[a].push(b) : this.funcLoaded[a] = [ b ];
    },
    onUpdate: function(a, b) {
        this.funcUpdate[a] ? this.funcUpdate[a].push(b) : this.funcUpdate[a] = [ b ];
    },
    onAdd: function(a, b) {
        this.funcAdd[a] ? this.funcAdd[a].push(b) : this.funcAdd[a] = [ b ];
    },
    onDelete: function(a, b) {
        this.funcDelete[a] ? this.funcDelete[a].push(b) : this.funcDelete[a] = [ b ];
    },
    emitLoaded: function(a, b) {
        if (this.funcLoaded[a]) for (var c = 0; c < this.funcLoaded[a].length; c++) this.funcLoaded[a][c](b);
    },
    emitUpdate: function(a, b, c) {
        if (this.funcUpdate[a]) for (var d = 0; d < this.funcUpdate[a].length; d++) this.funcUpdate[a][d](b, c);
    },
    emitAdd: function(a, b) {
        if (this.funcAdd[a]) for (var c = 0; c < this.funcAdd[a].length; c++) this.funcAdd[a][c](b);
    },
    emitDelete: function(a, b) {
        if (this.funcDelete[a]) for (var c = 0; c < this.funcDelete[a].length; c++) this.funcDelete[a][c](b);
    }
}, REST = {
    defaults: {
        readOnCreated: !0,
        successGetHeader: 200,
        successPostHeader: 201,
        successDeleteHeader: 204,
        successPutHeader: 200,
        variable_converter: function(a) {
            return a;
        },
        list_converter: function(a) {
            if (a = JSON.parse(a), a === !1) return !1;
            var b = {
                items: [],
                id: []
            };
            if ("object" != typeof a) return !1;
            for (var c = 0; c < a.length; c++) {
                if ("undefined" == typeof a[c].id) return !1;
                b.id[a[c].id] = b.items.push(a[c]) - 1;
            }
            return b;
        }
    }
};